/**
 * Especificacion JavaCC para la Practica 2 (Procesadores de Lenguajes)
 * Marcos Nuez - 761319@unizar.es
 * Alvaro Echavarri - 737400@unizar.es
 * v1.2 - 2021/03/16
 */
options
{
  static = true;
  ignore_case = true;
  
}

PARSER_BEGIN(minilengcompiler)

import java.io.*;

public class minilengcompiler {
  static boolean errorSintactico = false;
	  public static void main(String args []) throws ParseException {
	    if (args.length != 0 ) {
			File tmp = new File(args[0]);
			String file = tmp.getAbsolutePath();
			try {
				minilengcompiler parser = new minilengcompiler(new FileInputStream(file));
			}  
			catch (FileNotFoundException e) {
				System.out.printf("No existe el fichero: "+ file + "\n");
				System.exit(1);
			}
      	}
      	else {
      	    System.out.printf("Leyendo de la entrada estandar..." + "\n");
			minilengcompiler parser = new minilengcompiler(System.in);
        }    	
   		try {  
		    minilengcompiler.programa();

		    if ( errorSintactico ) {
				System.out.println("Hay uno o más errores sintácticos");
				System.exit(1);
		    }
		     
		    System.out.println("Analizado correctamente");	
		}
		catch(TokenMgrError e) {  
		     // ERRORES LEXICOS
		     try {
				String simbolo = String.valueOf(minilengcompilerTokenManager.input_stream.readChar());
		        String fil = String.valueOf(minilengcompilerTokenManager.input_stream.getEndLine());
		        String col = String.valueOf(minilengcompilerTokenManager.input_stream.getEndColumn());
		     
		        System.err.println("ERROR LÉXICO (<" + fil + ", " + col + ">): símbolo no reconocido: <" + simbolo + ">");
		        return;
		     }  
		     catch (Exception ex) { }
		}   
 	 }
 	 
 	 private static void error_sintactico(ParseException e, String mensaje) {
    	// ERRORES SINTACTICOS
    	Token ultimoLeido = minilengcompiler.getNextToken();
    	int fil = ultimoLeido.beginLine;
    	int col = ultimoLeido.beginColumn;
    	String current = ultimoLeido.image;
    
    	System.out.println("ERROR SINTÁCTICO (<" + fil  + ", " + col + ">): Símbolo obtenido -> " + current + " -> " + mensaje );
    	if ( !errorSintactico ) {
			errorSintactico = true;
   		}  
  }
}

PARSER_END(minilengcompiler)

< DEFAULT >SKIP :
{
  " "
| "\r"
| "\t"
| "\n"
| "%" : COMLINE
| "%%" : COMBLOCK
}

< COMLINE >SKIP :
{
  "\n" : DEFAULT
}

< COMBLOCK >SKIP :
{
  "%%" : DEFAULT
}


< COMLINE >MORE :
{
  < ~[ ] >
  {
   }
}

< COMBLOCK >MORE :
{
  < ~[ ] >
  {
   System.out.println("COMENTARIO DOBLE");
   }
}

TOKEN : /* CONTROLES DE FLUJO */
{
  < tPROGRAMA : "programa" >
  {
    System.out.println("PROGRAMA");
  }
| < tACCION : "accion" >
  {
    System.out.println("ACCION");
  }
| < tENT : "ent" >
  {
    System.out.println("ENT");
  }
| < tSI_NO : "si_no" >
  {
    System.out.println("SI_NO");
  }
| < tPRINCIPIO : "principio" >
  {
    System.out.println("PRINCIPIO");
  }  
| < tFIN : "fin" >
  {
    System.out.println("FIN");
  }
| < tMQ : "mq" >
  {
    System.out.println("MQ");
  }
| < tFMQ : "fmq" >
  {
    System.out.println("FMQ");
  }
| < tSI : "si" >
  {
    System.out.println("SI");
  }
| < tFSI : "fsi" >
  {
    System.out.println("FSI");
  }
}

TOKEN : /* FUNCIONES */
{
  < tMOD : "mod" >
  {
    System.out.println("MOD");
  }
| < tESCRIBIR : "escribir" >
  {
    System.out.println("ESCRIBIR");
  }
| < tLEER : "leer" >
  {
    System.out.println("LEER");
  }  
| < tENTACAR : "entacar" >
  {
    System.out.println("ENTACAR");
  }
| < tCARAENT : "caraent" >
  {
    System.out.println("CARAENT");
  }  
}
  
TOKEN : /* OPERADORES */
{
  < tSUMA : "+" >
  {
    System.out.println("SUMA");
  }
| < tRESTA : "-" >
  {
    System.out.println("RESTA");
  }
| < tMULL : "*" >
  {
    System.out.println("MULL");
  }
| < tDIV : "/" >
  {
    System.out.println("DIV");
  }
| < tDIV1 : "div" >
  {
    System.out.println("DIV1");
  }        
| < tMAYOR : ">" >
  {
    System.out.println("MAYOR");
  }
| < tMENOR : "<" >
  {
    System.out.println("MENOR");
  }
| < tIGUAL : "==" >
  {
    System.out.println("IGUAL");
  }
| < tOAS : ":=" >
  {
    System.out.println("OAS");
  }
| < tMAI : ">=" >
  {
    System.out.println("MAI");
  }
| < tMEI : "<=" >
  {
    System.out.println("MEI");
  }
| < tNI : "<>" >
  {
    System.out.println("NI");
  }
| < tAND : "and" >
  {
    System.out.println("AND");
  }              
| < tOR : "or" >
  {
    System.out.println("OR");
  }
| < tNOT : "not" >
  {
    System.out.println("NOT");
  }                                   
}

TOKEN : /* TIPOS DE DATOS */
{
  < tENTERO : "entero" >
  {
    System.out.println("ENTERO");
  }
| < tBOOLEANO : "booleano" >
  {
    System.out.println("BOOLEANO");
  }
| < tCARACTER : "caracter" >
  {
    System.out.println("CARACTER");
  }
| < tVAL : "val" >
  {
    System.out.println("VALOR");
  }
| < tREF : "ref" >
  {
    System.out.println("REFERENCIA");
  }
| < tTRUE : "true" >
  {
    System.out.println("TRUE");
  }
| < tFALSE : "false" >
  {
    System.out.println("FALSE");
  }      
}

TOKEN : /* AGRUPACIONES */
{
  <  tLLAVE_IZQ : "{" >
  {
    System.out.println("LLAVE_IZQ");
  }
| <  tLLAVE_DCHA : "}" >
  {
    System.out.println("LLAVE_DCHA");
  }
| <  tPA : "(" >
  {
    System.out.println("PA");
  }
| <  tPC : ")" >
  {
    System.out.println("PC");
  }   
}

TOKEN : /* VALORES */
{
  < #DIGITO : ["0"-"9"] >
| < #LETRA : ["a"-"z","_","0"-"9"] >
| < #BOOLEAN : "true" | "false" >
| < #LETRAID_INICIAL : ["a"-"z","_"] >
| < #LETRAID_FINAL : ["a"-"z","0"-"9"] >
| < #CARACTER : "\""~["\""] "\"" >
| < #CADENA : "\""(~["\""])+ "\"" >
| < #CADENA_VACIA : "\"""\"" >

| < tVALOR_ENTERO : (< DIGITO >)+ >
  {
    System.out.println("VALOR_ENTERO (Valor: " + matchedToken + ")");
  }
| < tVALOR_CARACTER : ("-")?(< CARACTER >) >
  {
    System.out.println("VALOR_CARACTER (Valor: " + matchedToken + ")");
  }
| < tVALOR_CADENA : ("-")?(< CADENA >) >
  {
    System.out.println("VALOR_CADENA (Valor: " + matchedToken + ")");
  }
| < tVALOR_CADENA_VACIA : ("-")?(< CADENA_VACIA >) >
  {
    System.out.println("VALOR_CADENA (Valor: " + matchedToken + ")");
  }
| < tVALOR_BOOLEANO : ("-")?(< BOOLEAN >) >
  {
    System.out.println("VALOR_BOOLEANO (Valor: " + matchedToken + ")");
  }
| <  tIDENTIFICADOR_ASIG : ((< LETRAID_INICIAL >)(< LETRA >)+(< LETRAID_FINAL >) | (< LETRAID_INICIAL >) | (< LETRAID_INICIAL >)(< LETRAID_FINAL >))(" ")*(< tOAS >) >
  {
    System.out.println("IDENTIFICADOR_ASIG (Valor: " + matchedToken + ")");
  } 
| <  tIDENTIFICADOR : (< LETRAID_INICIAL >)(< LETRA >)+(< LETRAID_FINAL >) | (< LETRAID_INICIAL >) | (< LETRAID_INICIAL >)(< LETRAID_FINAL >) >
  {
    System.out.println("IDENTIFICADOR (Valor: " + matchedToken + ")");
  }
}


TOKEN : /* FINES DE SENTENCIA */
{
  <  tFIN_SENTENCIA : ";" >
  {
    System.out.println("FIN_SENTENCIA");
  }
| <  tCOMA : "," >
  {
    System.out.println("COMA");
  }
}


void programa():
{
}
{
  try { 
  	< tPROGRAMA > < tIDENTIFICADOR > < tFIN_SENTENCIA > (declaracion_variables()) (declaracion_acciones())
 	 (bloque_sentencias())*
  }catch(ParseException e) {
		error_sintactico(e,"Error en programa");
	}
}

void sentencia():
{
}
{
try { 
  	(leer()) < tFIN_SENTENCIA >
 |  (escribir()) < tFIN_SENTENCIA >
 |  (asignacion()) < tFIN_SENTENCIA >
 |	(invocacion_accion()) 
 |	(seleccion()) 
 |	(mientras_que())
 | 	(si())
 
}catch(ParseException e) {
	error_sintactico(e,"Error en sentencia");
}
}

void asignacion():
{
}
{
  try { 
  < tIDENTIFICADOR_ASIG > expresion()
}catch(ParseException e) {
	error_sintactico(e,"Error en asignacion");
}
}

void invocacion_accion():
{
}
{
  try {
    
  <tIDENTIFICADOR>(< tFIN_SENTENCIA >|argumentos()< tFIN_SENTENCIA >)
}catch(ParseException e) {
	error_sintactico(e,"Error en invocacion_accion");
}
}

void declaracion_variables():
{
}
{
  try { 
  	( declaracion() ";" )*
 }catch(ParseException e) {
	error_sintactico(e,"Error en declaracion_variables");
}
}

void declaracion():
{
}
{
  try { 
  	tipo_variables() identificadores()
 }catch(ParseException e) {
	error_sintactico(e,"Error en declaracion");
}
}

void tipo_variables():
{
}
{
  try { 
  	< tENTERO > | < tCARACTER > | < tBOOLEANO >
 }catch(ParseException e) {
	error_sintactico(e,"Error en tipo_variables");
}
}

void identificadores():
{
}
{
  try { 
  	< tIDENTIFICADOR > ( "," < tIDENTIFICADOR > )*
 }catch(ParseException e) {
	error_sintactico(e,"Error en identificadores");
}
}

void declaracion_acciones():
{
}
{
  try { 
  	( declaracion_accion() )*
 }catch(ParseException e) {
	error_sintactico(e,"Error en declaracion_acciones");
}
}

void declaracion_accion():
{
}
{
  try { 
  	cabecera_accion() declaracion_variables() declaracion_acciones() bloque_sentencias()
 }catch(ParseException e) {
	error_sintactico(e,"Error en declaracion_accion");
}
}

void cabecera_accion():
{
}
{
  try { 
  	< tACCION > < tIDENTIFICADOR > (parametros_formales())?< tFIN_SENTENCIA >
 }catch(ParseException e) {
	error_sintactico(e,"Error en cabecera_accion");
}
}

void parametros_formales():
{
}
{
  try { 
  < tPA >(parametros() (< tFIN_SENTENCIA > parametros())*)?< tPC >
}catch(ParseException e) {
	error_sintactico(e,"Error en parametros_formales");
}
}

void parametros():
{
}
{
  try { 
  	clase_parametros() tipo_variables() identificadores()
 }catch(ParseException e) {
	error_sintactico(e,"Error en parametros");
}
}

void clase_parametros():
{
}
{
  try { 
  	< tVAL > | < tREF >
 }catch(ParseException e) {
	error_sintactico(e,"Error en clase_parametros");
}
}

void bloque_sentencias():
{
}
{
  try { 
  	< tPRINCIPIO > lista_sentencias() < tFIN >
 }catch(ParseException e) {
	error_sintactico(e,"Error en bloque_sentencias");
}
}

void lista_sentencias():
{
}
{
  try { 
  	(sentencia())*
 }catch(ParseException e) {
	error_sintactico(e,"Error en lista_sentencias");
}
}

void leer():
{
}
{
  try { 
  	< tLEER > < tPA > identificadores() < tPC >
 }catch(ParseException e) {
	error_sintactico(e,"Error en leer");
}
}

void escribir():
{
}
{
  try { 
  	< tESCRIBIR > < tPA > lista_escribibles() < tPC >
 }catch(ParseException e) {
	error_sintactico(e,"Error en escribir");
}
}

void caraent():
{
}
{
  try { 
  < tCARAENT ><tPA >(expresion())<tPC >
}catch(ParseException e) {
	error_sintactico(e,"Error en caraent");
}
}

void entacar():
{
}
{
  try { 
  < tENTACAR ><tPA >(expresion())<tPC >
}catch(ParseException e) {
	error_sintactico(e,"Error en entacar");
}
}

void lista_escribibles():
{
}
{
  try { 
  	( expresion() ) ( < tCOMA > (expresion() ) )*
}catch(ParseException e) {
	error_sintactico(e,"Error en lista_escribibles");
}
}

void mientras_que():
{
}
{
  try { 
  	< tMQ > expresion()( ( < tAND > | < tOR > ) expresion())* lista_sentencias() < tFMQ >
 }catch(ParseException e) {
	error_sintactico(e,"Error en mientras_que");
}
}

void si():
{
}
{
  try { 
  	< tSI > expresion()( ( < tAND > | < tOR > ) expresion())* < tENT > lista_sentencias() (< tSI_NO > lista_sentencias())* < tFSI >
 }catch(ParseException e) {
	error_sintactico(e,"Error en si");
}
}

void argumentos():
{
}
{
  try { 
  	< tPA > ( lista_expresiones() )? < tPC >
 }catch(ParseException e) {
	error_sintactico(e,"Error en argumentos");
}
}

void lista_expresiones():
{
}
{
  try { 
  	expresion()(","expresion())*
 }catch(ParseException e) {
	error_sintactico(e,"Error en lista_expresiones");
}
}

void seleccion():
{
}
{
  try { 
  	< tPRINCIPIO > < tIDENTIFICADOR > < tLLAVE_IZQ > (sentencia())* < tLLAVE_DCHA >
 }catch(ParseException e) {
	error_sintactico(e,"Error en seleccion");
}
}

void expresion():
{
}
{
  try { 
   factor()( (operador_relacional()|operador_aditivo()|operador_multiplicativo()) factor() )*
 }catch(ParseException e) {
	error_sintactico(e,"Error en expresion");
}
}
void operador_relacional():
{
}
{
  try { 
	 < tMENOR >
	| < tMAYOR >
	| < tMEI >
	| < tMAI >
	| < tIGUAL >
	| < tNI >
	| < tAND >
	| < tOR >
}catch(ParseException e) {
	error_sintactico(e,"Error en operador_relacional");
}
}

void operador_aditivo():
{
}
{
  try { 
  < tRESTA >
	| < tSUMA >
}catch(ParseException e) {
	error_sintactico(e,"Error en operador_adictivo");
}
}

void operador_multiplicativo():
{
} 
{
  try { 
  < tMULL >
	| < tDIV >
	| < tDIV1 >
	| < tMOD >
}catch(ParseException e) {
	error_sintactico(e,"Error en operador_multiplicativo");
}
}

void factor():
{
}
{
  try { 
  (< tRESTA >|< tNOT >)? factor2()
}catch(ParseException e) {
	error_sintactico(e,"Error en factor");
}
}

void factor2():
{
}
{
  try { 
   < tPA > expresion() < tPC >
| < tENTACAR > < tPA > expresion() < tPC >
| < tCARAENT > < tPA > expresion() < tPC >
| < tIDENTIFICADOR >
| < tENTERO >
| < tVALOR_CARACTER >
| < tVALOR_CADENA >
| < tVALOR_CADENA_VACIA >
| < tVALOR_ENTERO >
| < tTRUE >
| < tFALSE >
}catch(ParseException e) {
	error_sintactico(e,"Error en factor2");
}
}